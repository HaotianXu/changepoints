---
title: "example_univar"
author: "Haotian Xu"
date: "9/2/2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

This is a simple guide for offline multiple change points detection on univariate mean.

There are 3 methods implemented for univariate mean changepoint detection:

1. _DP.univar_: performs dynamic programming for univariate mean changepoint detection through l0 penalty.
   + _CV.search.DP.univar_: perform grid search to select the tuning parameter through Cross-Validation.
   
2. _BS.univar_: performs standard binary segmentation for univariate mean changepoint detection.

3. _WBS.univar_: performs wild binary segmentation for univariate mean changepoint detection.

In addition, function _local.refine.univar_ performs local refinement for an initial changepoint estimation.

# Simulate data
```{r}
library(changepoints)
delta = 10 # 2*delta represents the minimum gap between boundaries
sigma2 = 1 # error variance

set.seed(0)
y = c(rep(0, 50), rep(1, 50), rep(0, 50), rep(1, 50)) + rnorm(200, mean = 0, sd = sqrt(sigma2)) # univariate time series
cpt_true = c(50, 100, 150)
n = length(y) # sample size
```

# Perform dynamic programming
```{r}
gamma.set = c(0.01, 0.5, 1, 5, 10, 50) # a set of tuning parameters for DP
DP_result = CV.search.DP.univar(y, gamma.set, delta = 5) # grid search through cross-validation
min_idx = which.min(DP_result$test_error) # select gamma achieves the minimum validation error
cpt_DP_hat = unlist(DP_result$cpt_hat[[min_idx]]) # estimated changepoints by DP
cpt_DP_hat
Hausdorff.dist(cpt_DP_hat, cpt_true)
cpt_DPlr_hat = local.refine.univar(cpt_DP_hat, y, w = 1/3) # perform local refinement
cpt_DPlr_hat
Hausdorff.dist(cpt_DPlr_hat, cpt_true)
```

# Perform standard binary segmentation
```{r}
tau_BS = 3 # threshold parameter for BS
BS_result = threshold.BS(BS.univar(y, 1, n, delta), tau_BS)
BS_result$BS_tree_trimmed # trace BS
BS_result$change_points
cpt_BS_hat = sort(BS_result$change_points[,1]) # estimated changepoints by BS
cpt_BS_hat
Hausdorff.dist(cpt_BS_hat, cpt_true)
cpt_BSlr_hat = local.refine.univar(cpt_BS_hat, y, w = 1/3) # perform local refinement
cpt_BSlr_hat
Hausdorff.dist(cpt_BSlr_hat, cpt_true)
```

# Perform wild binary segmentation
```{r}
tau_WBS = 3 # threshold parameter for WBS
intervals = WBS.intervals(M = 300, lower = 1, upper = n) # generate random intervals for WBS
WBS_result = threshold.BS(WBS.univar(y, 1, n, intervals$Alpha, intervals$Beta, delta), tau_WBS)
WBS_result$BS_tree_trimmed # trace BS
WBS_result$change_points
cpt_WBS_hat = sort(WBS_result$change_points[,1]) # estimated changepoints by WBS
cpt_WBS_hat
Hausdorff.dist(cpt_WBS_hat, cpt_true)
cpt_WBSlr_hat = local.refine.univar(cpt_WBS_hat, y, w = 1/3) # perform local refinement
cpt_WBSlr_hat
Hausdorff.dist(cpt_WBSlr_hat, cpt_true)
```
